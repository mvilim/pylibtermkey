language: python

matrix:
  include:
    - sudo: required
      services:
        - docker
    - os: osx
      language: generic

env:
  global:
    - CIBW_SKIP='cp27-*'
    - CIBW_BEFORE_BUILD='pip install cmake'
    - CIBW_TEST_REQUIRES=nose
    - CIBW_TEST_COMMAND='nosetests {project}/python/pylibtermkey'
    # encrypted TWINE_PASSWORD
    - secure: pv8MqNT0UBfRHxbASqbHNte4uspq/PeqHJiRsnwZL2hg4DfduUQiZuXGhcY0zW6c0eQ/HPJtUhM/meVzkOgVedrVlhQHsOpeI1FhXztEoGk9sr0g/4PneK1W4ZXOXKZ0DVV99cWDcGL7UDGBxc2vR3FrUAcNUWDpVvtn/O7YHv1Se8gJmoZBESVFNQuLv0j3uDlgZ3fEJf4T3utm7lGBONilGpdIsBnbGUf47URUquc1aL9sFYqrleLULeTj4yNS6nKF5sPDj1IwpDA2RKqFLDo19wPAEvj/Pob5P075iilbyzKFnIodq49tWCh7NNmwlXSsQUNCz5HPzQElTnZ8YwC43VXMgnJuRGPfjWlTv7G2Z+UZjmFhMWRnTqFAswarQNLySWN6VG2/LeaLosRLV4b4DloGHL+9fZdKlAkVTKA+T1kgG9fBW2EDU2kevawDW72LIdg4c2HmRFOXhPx/VlUcK5OvbxDbhVPj2hVwPEhSitxQwuWKp0A+MWMopWdz24bj11r8wpEDNexElGAo7PJmkkCXuRnHpfSstJZYzmhZAqbLgoCVj8sdYuqDx05GaUnJvaWY6W5xoCqyrqGrcMcpiA68sEN0f2FVJBpXtyghTFl0+Yu0PhEFfLmIWgeMXluaDnD2DFIfkVVNfhRnawsdwMsxROKB2oMvowQQjAc=

script:
  # temporary fix for https://github.com/joerick/cibuildwheel/issues/122
  # - pip install cibuildwheel==0.10.0
  - pip install git+https://github.com/YannickJadoul/cibuildwheel.git@pip-19-stalling-workaround
  - cibuildwheel --output-dir dist
  - python setup.py sdist --dist-dir dist

deploy:
  provider: script
  script: bash scripts/deploy.sh
  on:
    branch: master
    tags: true
