language: python

matrix:
  include:
    - sudo: required
      services:
        - docker
    - os: osx
      language: generic

env:
  global:
    - CIBW_BUILD='cp37-*'
    - CIBW_BEFORE_BUILD='pip install cmake'
    - CIBW_TEST_REQUIRES=nose
    - CIBW_TEST_COMMAND='nosetests {project}/python/pylibtermkey'
    - TWINE_USERNAME='michael.vilim'
    # encrypted TWINE_PASSWORD
    - secure: 0A+p3XJ5VFYqKu72oMP2s8Y+t9jzdfspHxu9qEZgF1RmiY3ZYz10mnU9LARDRxokx+n3/rkoR8P3hrtWE8XxOct7uTK0DdPC9LfuvLpaQVtOmW8oksYvEny6G0i+5XDKm26q+lP8OGraNBytPRzYdyptRKsqVH20vO8EKgj/IQZRbNk+JnIM6VJ0ysk8dmaVBlvjkoTYBe6JHQW6Z2fYmMR+7QgVPE7chTV08AS+w/nV/GHgC7/mekKJv9puJDxbFOCdiEh3Rv/NsPgJrpYequOgDEE4kYu0++2+aCR9UwwYE1+al7bxRVkLqGXsy5y0GDWliu49cu4TYnpkKSrOC9C+w+qysDq+557Xlebaa38a5dsNY2hS1bfr4Q1GhhkSFVTnxLuvuFAZC/kreo9PSaP34GRscTPdAepdeXwj3B924zy36sLnCcJx1RwRayUS0zMjloeas2BiPl+rcJWdQz3Ai3e3z1+mir6TmDnYAuXjK+52qnfv7riYSQo3FiKrUJsnfCkw056B89iHmuZHDBGPcjoPPLeWZZ0E63SLCPACuKJe8xUPCNHeq2Nk4GuG28UK0w7u7+AULGOm0fNjGra5hoWbp5GsspAcBmBEgHZQEhLEKxEPe9O1iUF9csnfXLnp67fNZJFfG/TRt4K2+s98A5eMmjQn5sx/NPnsnVE=

script:
  # temporary fix for https://github.com/joerick/cibuildwheel/issues/122
  # - pip install cibuildwheel==0.10.0
  - pip install git+https://github.com/YannickJadoul/cibuildwheel.git@pip-19-stalling-workaround
  - cibuildwheel --output-dir dist
  - python setup.py sdist --dist-dir dist

deploy:
  provider: script
  script: bash scripts/deploy.sh
  on:
    tags: true
